{"version":3,"file":"index.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["function strToCompareArray(str) {\r\n\r\n    return str.split(/\\W+/g).map(c => c.trim().toLowerCase()).filter(c => c.length > 1);\r\n\r\n}\r\n\r\nfunction compareStr(a, b) {\r\n\r\n    if (typeof a === 'string') a = strToCompareArray(a);\r\n    if (typeof b === 'string') b = strToCompareArray(b);\r\n\r\n    let tot = 0;\r\n    for (let i = 0, l = a.length; i < l; i++) {\r\n\r\n        if (b.includes(a[i])) tot++;\r\n\r\n    }\r\n\r\n    return tot / Math.min(a.length, b.length);\r\n\r\n}\r\n\r\nfunction findMatch(name, list) {\r\n\r\n    let matches = null;\r\n    let score = -Infinity;\r\n\r\n    const versionMatches = /\\w*\\d\\d\\d+\\w*/.exec(name);\r\n    let versionRegexp = null;\r\n    if (versionMatches) {\r\n        versionRegexp = new RegExp(`(^|\\\\W)${ versionMatches[0] }(\\\\W|$)`, 'i');\r\n    }\r\n\r\n    const gpuArr = strToCompareArray(name);\r\n    for (let i = 0, l = list.length; i < l; i++) {\r\n\r\n        const name = list[i];\r\n        if (versionRegexp && !versionRegexp.test(name)) continue;\r\n        if (!versionRegexp && /\\d\\d\\d+/.test(name)) continue;\r\n\r\n        const similarity = compareStr(name, gpuArr);\r\n        if (similarity > score) {\r\n\r\n            score = similarity;\r\n            matches = [name];\r\n\r\n        } else if (similarity === score) {\r\n\r\n            matches.push(name);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return { matches, score };\r\n\r\n}\r\n\r\nexport { findMatch };\r\n","import { findMatch } from './utils.js';\r\n\r\nfunction extractValue(reg, str) {\r\n    const matches = str.match(reg);\r\n    return matches && matches[0];\r\n}\r\n\r\nfunction getVendorRenderer(gl) {\r\n\r\n    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\r\n    if (!debugInfo) {\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);\r\n    const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\r\n\r\n    return { vendor, renderer };\r\n\r\n}\r\n\r\nfunction parseGpuInfo(vendor, renderer) {\r\n\r\n    // Full card description and webGL layer (if present)\r\n    const layer = extractValue(/(ANGLE)/g, renderer);\r\n    const name = extractValue(/(NVIDIA|AMD|Intel)\\D*\\d*\\S*/, renderer) || renderer;\r\n\r\n    return {\r\n\r\n        name: name.trim(),\r\n\r\n        unmasked: {\r\n            vendor,\r\n            renderer,\r\n        },\r\n\r\n        integrated: /Intel/i.test(name),\r\n        layer,\r\n\r\n    };\r\n\r\n}\r\n\r\nfunction getBasicInfo(glOrRenderer = null, vendor = null) {\r\n\r\n    glOrRenderer = glOrRenderer || document.createElement('canvas').getContext('webgl');\r\n\r\n    let renderer = null;\r\n    if (typeof glOrRenderer === 'string') {\r\n\r\n        renderer = glOrRenderer;\r\n\r\n    } else {\r\n\r\n        const vr = getVendorRenderer(glOrRenderer);\r\n        if (!vr) return null;\r\n\r\n        renderer = vr.renderer;\r\n        vendor = vr.vendor;\r\n\r\n    }\r\n\r\n    return parseGpuInfo(vendor, renderer);\r\n\r\n}\r\n\r\nfunction rendererToGpu(database, renderer) {\r\n\r\n    const gpuNames = Object.keys(database);\r\n    const { matches, score } = findMatch(renderer, gpuNames);\r\n\r\n    return score > 0.5 ? database[matches[0]] : null;\r\n\r\n}\r\n\r\nfunction getDetailedInfo(database, glOrRenderer = null) {\r\n\r\n    glOrRenderer = glOrRenderer || document.createElement('canvas').getContext('webgl');\r\n\r\n    let renderer = null;\r\n    if (typeof glOrRenderer === 'string') {\r\n\r\n        renderer = glOrRenderer;\r\n\r\n    } else {\r\n\r\n        const vr = getVendorRenderer(glOrRenderer);\r\n        if (!vr) return null;\r\n\r\n        renderer = vr.renderer;\r\n\r\n    }\r\n\r\n    return rendererToGpu(database, renderer);\r\n\r\n}\r\n\r\nexport { getDetailedInfo, getBasicInfo };\r\n"],"names":["strToCompareArray","str","split","map","c","trim","toLowerCase","filter","length","compareStr","a","b","tot","i","l","includes","Math","min","findMatch","name","list","matches","score","Infinity","versionMatches","exec","versionRegexp","RegExp","gpuArr","test","similarity","push","extractValue","reg","match","getVendorRenderer","gl","debugInfo","getExtension","vendor","getParameter","UNMASKED_VENDOR_WEBGL","renderer","UNMASKED_RENDERER_WEBGL","parseGpuInfo","layer","unmasked","integrated","getBasicInfo","glOrRenderer","document","createElement","getContext","vr","rendererToGpu","database","gpuNames","Object","keys","getDetailedInfo"],"mappings":"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"}
{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["function extractValue(reg, str) {\r\n    const matches = str.match(reg);\r\n    return matches && matches[0];\r\n}\r\n\r\nfunction getVendorRenderer(gl) {\r\n\r\n    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\r\n    if (!debugInfo) {\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);\r\n    const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\r\n\r\n    return { vendor, renderer };\r\n\r\n}\r\n\r\nfunction parseGpuInfo(vendor, renderer) {\r\n\r\n    // Full card description and webGL layer (if present)\r\n    const layer = extractValue(/(ANGLE)/g, renderer);\r\n    const card = extractValue(/((NVIDIA|AMD|Intel)[^\\d]*[^\\s]+)/, renderer);\r\n\r\n    const tokens = card.split(' ');\r\n    tokens.shift();\r\n\r\n    // Split the card description up into pieces\r\n    // with brand, manufacturer, card version\r\n    const manufacturer = extractValue(/(NVIDIA|AMD|Intel)/g, card);\r\n    const cardVersion = tokens.pop();\r\n    const brand = tokens.join(' ');\r\n    const integrated = manufacturer === 'Intel';\r\n\r\n    return {\r\n\r\n        card,\r\n        manufacturer,\r\n        cardVersion,\r\n        brand,\r\n        integrated,\r\n        layer,\r\n        unmasked: {\r\n            vendor,\r\n            renderer,\r\n        },\r\n    };\r\n\r\n}\r\n\r\nfunction getBasicInfo(gl = null) {\r\n\r\n    gl = gl || document.createElement('canvas').getContext('webgl');\r\n\r\n    const vr = getVendorRenderer(gl);\r\n    return vr ? parseGpuInfo(vr.vendor, vr.renderer) : null;\r\n\r\n}\r\n\r\nfunction strToCompareArray(str) {\r\n\r\n    return str.split(/\\W+/g).map(c => c.trim().toLowerCase()).filter(c => c.length > 1);\r\n\r\n}\r\n\r\nfunction compareStr(a, b) {\r\n\r\n    if (typeof a === 'string') a = strToCompareArray(a);\r\n    if (typeof b === 'string') b = strToCompareArray(b);\r\n\r\n    let tot = 0;\r\n    for (let i = 0, l = a.length; i < l; i++) {\r\n\r\n        if (b.includes(a[i])) tot++;\r\n\r\n    }\r\n\r\n    return tot / Math.min(a.length, b.length);\r\n\r\n}\r\n\r\nfunction rendererToGpu(database, renderer) {\r\n\r\n    const gpuNames = Object.keys(database);\r\n    let gpuName = null;\r\n    let compare = -Infinity;\r\n\r\n    const numMatches = /\\w*\\d\\d\\d+\\w*/.exec(renderer);\r\n    let numRegexp = null;\r\n    if (numMatches) {\r\n        numRegexp = new RegExp(`(^|\\\\W)${ numMatches[0] }(\\\\W|$)`, 'i');\r\n    }\r\n\r\n    const gpuArr = strToCompareArray(renderer);\r\n    for (let i = 0, l = gpuNames.length; i < l; i++) {\r\n\r\n        const name = gpuNames[i];\r\n        if (numRegexp && !numRegexp.test(name)) continue;\r\n        if (!numRegexp && /\\d\\d\\d+/.test(name)) continue;\r\n\r\n        const similarity = compareStr(name, gpuArr);\r\n        if (similarity > compare) {\r\n\r\n            compare = similarity;\r\n            gpuName = gpuNames[i];\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return compare > 0.5 ? database[gpuName] : null;\r\n\r\n}\r\n\r\nfunction getDetailedInfo(database, glOrString = null) {\r\n\r\n    glOrString = glOrString || document.createElement('canvas').getContext('webgl');\r\n\r\n    let renderer = null;\r\n    if (typeof glOrString === 'string') {\r\n\r\n        renderer = glOrString;\r\n    \r\n    } else {\r\n\r\n        const vr = getVendorRenderer(glOrString);\r\n        if (!vr) return null;\r\n\r\n        renderer = vr.renderer;\r\n\r\n    }\r\n\r\n    return rendererToGpu(database, renderer);\r\n\r\n}\r\n\r\nexport { getDetailedInfo, getBasicInfo };\r\n"],"names":[],"mappings":"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"}